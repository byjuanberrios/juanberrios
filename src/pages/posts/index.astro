---
import { getPublishedPostsByYear } from "@/utils";
import Layout from "@/layout/Layout.astro";

const allPosts = await getPublishedPostsByYear();
const allPostsLength = Object.keys(allPosts).reduce((acc, year) => {
  return acc + allPosts[year].length;
}, 0);
---

<Layout
  title="Todos los posts"
  description="Todos los posts publicados en el sitio web"
>
  <header
    class="lateral-spacing mt-20 md:mt-40 mb-14 md:mb-20 flex justify-between items-end"
  >
    <div>
      <p class="text-xs md:text-sm mb-2.5 md:mb-4 opacity-50 font-sans">
        Archivo
      </p>
      <h1 class="text-3xl md:text-5xl font-display">Todos los posts</h1>
    </div>
    <span class="text-xs md:text-sm opacity-50 font-sans">
      (<span class="italic">{allPostsLength}</span> posts)
    </span>
  </header>

  <section class="lateral-spacing">
    <div>
      {
        Object.keys(allPosts)
          .sort((yearA, yearB) => (yearA < yearB ? 1 : -1))
          .map((year) => (
            <div class="mb-10 md:mb-12 lg:mb-14 last:mb-0">
              <h2 class="font-semibold mb-4 md:mb-4 text-base md:text-lg">
                {year}
              </h2>
              <div class="grid gap-1.5 md:gap-2">
                {allPosts[year]
                  .sort((dateA, dateB) => (dateA < dateB ? 1 : -1))
                  .map((post) => {
                    const date = post.date.slice(0, 10);
                    const postDate = new Date(date);
                    const longMonth = postDate.toLocaleString("es-ES", {
                      month: "long",
                    });
                    const shortMonth = postDate.toLocaleString("es-ES", {
                      month: "short",
                    });
                    const day = postDate.getDate();
                    return (
                      <a
                        href={`/posts/${post.slug}`}
                        class="group showcase-link flex items-center truncate w-full gap-3 md:gap-5"
                      >
                        <span class="title font-sans truncate tracking-tight">
                          {post.title}
                        </span>
                        <span class="date font-sans tracking-tight opacity-40 inline truncate text-xs md:text-sm">
                          <span class="block md:hidden">
                            {day} de{" "}
                            <span class="capitalize">{shortMonth}</span>
                          </span>
                          <span class="hidden md:block">
                            {day} de <span class="capitalize">{longMonth}</span>
                          </span>
                        </span>
                      </a>
                    );
                  })}
              </div>
            </div>
          ))
      }
    </div>
  </section>
</Layout>
